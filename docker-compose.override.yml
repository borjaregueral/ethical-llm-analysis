# ═══════════════════════════════════════════════════════════════════════════════
# Development overrides — automatically merged when you run `docker compose up`
#
# Adds live-reload bind mounts so you can edit app/ or demos/ on the host
# and see changes without rebuilding the image.
#
# NOT applied when you run:
#   docker compose -f docker-compose.yml up   (production / student deployment)
# ═══════════════════════════════════════════════════════════════════════════════

services:
  llm-server:
    volumes:
      - ./llm-server/app:/workspace/app:ro   # edit code → restart uvicorn to reload
      - ${HOME}/.cache/huggingface:/hf_cache # host HF model cache (read-only at runtime)
    environment:
      - HF_HOME=/hf_cache                    # point transformers at the mounted cache
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 4G                         # Qwen2.5-0.5B needs ~2-3 GB

  attacker:
    volumes:
      - ./demos:/workspace/demos:ro
      - ./notebooks:/workspace/notebooks:ro
